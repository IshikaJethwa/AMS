<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>AVMS Visitors</title>

    <!-- Fontfaces CSS-->
    <link href="../css/font-face.css" rel="stylesheet" media="all">
    <link href="../vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="../vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="../vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="../vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- ../vendor CSS-->
    <link href="../vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="../vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="../vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="../vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="../vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="../vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="../vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="../css/theme.css" rel="stylesheet" media="all">
    <style>
        /* Custom styles for the Thank You card */
        .thank-you-card {
            border: 2px solid #28a745;
            /* Green border color */
            border-radius: 10px;
            /* Rounded corners */
            margin-bottom: 20px;
            /* Add some spacing at the bottom */
            position: relative;
            padding-right: 30px;
            /* Adjust padding for the right icon */
        }

        .thank-you-card .card-body {
            color: #28a745;
            /* Text color */
        }

        .right-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 5px;
            color: #28a745;
            /* Green color for the icon */
            cursor: pointer;
            font-size: 2.5rem;
            margin-right: 2%;
            /* Adjust font size for the icon */
        }
    </style>
    <script>
        // Fetch and include sidebar content
        fetch('../includes/sidebarUser.html')
            .then(response => response.text())
            .then(data => document.getElementById('sidebar-container').innerHTML = data);

        // Fetch and include header content
        fetch('../includes/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                var menu = $('.js-item-menu');
                var sub_menu_is_showed = -1;

                for (var i = 0; i < menu.length; i++) {
                    $(menu[i]).on('click', function (e) {
                        e.preventDefault();
                        $('.js-right-sidebar').removeClass("show-sidebar");
                        if (jQuery.inArray(this, menu) == sub_menu_is_showed) {
                            $(this).toggleClass('show-dropdown');
                            sub_menu_is_showed = -1;
                        }
                        else {
                            for (var i = 0; i < menu.length; i++) {
                                $(menu[i]).removeClass("show-dropdown");
                            }
                            $(this).toggleClass('show-dropdown');
                            sub_menu_is_showed = jQuery.inArray(this, menu);
                        }
                    });
                }
                $(".js-item-menu, .js-dropdown").click(function (event) {
                    event.stopPropagation();
                });

                var userDataString = sessionStorage.getItem('user');


                // Step 2: Parse the JSON string to get the user data as an object
                var userData = userDataString ? JSON.parse(userDataString) : null;

                // Step 3: Update the content of the header dynamically if userData is not null
                if (userData) {

                    document.getElementById('adminNameLink').textContent = userData.username;
                    document.getElementById('adminNameDropdown').textContent = userData.username;
                } else {
                    console.error('User data is missing or invalid.');
                }
            });

    </script>
</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER MOBILE-->
        <div id="sidebar-container"></div>
        <!-- END HEADER MOBILE-->

        <!-- MENU SIDEBAR-->
        <!-- Include your menu sidebar content here -->
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <div id="header-container"></div>
            <!-- END HEADER DESKTOP-->

            <!-- MAIN CONTENT -->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">

                        <!-- Thank You Card -->
                        
                        <div class="row mb-2">
                            <div class="col-md-12 ">
                                <button class="btn btn-primary m-2" data-toggle="modal" data-target="#addComplaintModal"
                                    onclick="window.location.href='maintainance.html';"><i class="bi bi-plus"></i>Add
                                    Maintanance</button>

                                <a href="#" class="btn btn-success float-right m-2" download>
                                    <i class="fa fa-download"></i> Download Receipt
                                </a>

                            </div>
                        </div>
                        <!-- Payment Details Table -->
                        <div class="card">
                            <div class="card-header">
                                <strong>Payment Details</strong>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th scope="col">ID</th>
                                            <th scope="col">Unit ID</th>
                                            <th scope="col">Month</th>
                                            <th scope="col">Year</th>
                                            <th scope="col">Payment Date</th>
                                            <th scope="col">Amount</th>
                                            <th scope="col">Transaction ID</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentDetailsBody">
                                        <!-- Payment details will be dynamically added here using JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Jquery JS-->
        <script src="../vendor/jquery-3.2.1.min.js"></script>
        <!-- Bootstrap JS-->
        <script src="../vendor/bootstrap-4.1/popper.min.js"></script>
        <script src="../vendor/bootstrap-4.1/bootstrap.min.js"></script>
        <!-- ../vendor JS -->
        <script src="../vendor/slick/slick.min.js"></script>
        <script src="../vendor/wow/wow.min.js"></script>
        <script src="../vendor/animsition/animsition.min.js"></script>
        <script src="../vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
        <script src="../vendor/counter-up/jquery.waypoints.min.js"></script>
        <script src="../vendor/counter-up/jquery.counterup.min.js"></script>
        <script src="../vendor/circle-progress/circle-progress.min.js"></script>
        <script src="../vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
        <script src="../vendor/chartjs/Chart.bundle.min.js"></script>
        <script src="../vendor/select2/select2.min.js"></script>

        <!-- Main JS -->
        <script src="../js/main.js"></script>
        <script>
            $(document).ready(function () {
                // Use AJAX or fetch to get user details from the server and update the HTML elements
                // Example:
                var unitid;
                const userDataString = sessionStorage.getItem('user');

                // Check if user data exists
                if (userDataString) {
                    // Parse the JSON string to get the user data as an object
                    const userData = JSON.parse(userDataString);

                    // Send a POST request to the server to get user details
                    $.ajax({
                        url: 'http://localhost:62416/api/getUser',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            role: userData.role,
                            username: userData.username,
                            password: userData.password
                        }),
                        success: function (user) {
                            unitid = user.UnitID;
                            // Update the HTML elements with user details

                            fetchPaymentDetailsByUnitId(unitid);



                        },
                        error: function (error) {
                            alert('Error:', error);
                        }
                    });
                } else {
                    alert('User data is missing or invalid.');
                }
            });
            function fetchPaymentDetailsByUnitId(unitId) {
                $.ajax({
                    url: `http://localhost:62416/api/User/CheckMaintanace/${unitId}`,
                    type: 'GET',
                    success: function (maintenanceList) {
                        // Clear existing rows
                        $('#paymentDetailsBody').empty();

                        // Populate the table with fetched data
                        maintenanceList.forEach(function (maintenance) {
                            $('#paymentDetailsBody').append(`
                    <tr>
                        <td>${maintenance.idMaintainance}</td>
                        <td>${maintenance.Unit_ID}</td>
                        <td>${maintenance.Month}</td>
                        <td>${maintenance.Year}</td>
                        <td>${maintenance.PaymentDate}</td>
                        <td>${maintenance.Amount}</td>
                        <td>${maintenance.Transaction_ID}</td>
                    </tr>
                `);
                        });
                    },
                    error: function (error) {
                        console.log('Error fetching payment details:', error);
                    }
                });
            }
        </script>
</body>

</html>