<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="AVSM Users Details">
  <meta name="author" content="Your Name">
  <meta name="keywords" content="AVSM user details template">

  <!-- Title Page-->
  <title>AVSM Users Details</title>

  <!-- Fontfaces CSS-->
  <link href="../css/font-face.css" rel="stylesheet" media="all">
  <link href="../vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
  <link href="../vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
  <link href="../vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

  <!-- Bootstrap CSS-->
  <link href="../vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- Vendor CSS-->
  <link href="../vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
  <link href="../vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
  <link href="../vendor/wow/animate.css" rel="stylesheet" media="all">
  <link href="../vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
  <link href="../vendor/slick/slick.css" rel="stylesheet" media="all">
  <link href="../vendor/select2/select2.min.css" rel="stylesheet" media="all">
  <link href="../vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

  <!-- Main CSS-->
  <link href="../css/theme.css" rel="stylesheet" media="all">

  <!-- Include external HTML files using JavaScript -->
  <script>
    // Fetch and include sidebar content
    fetch('../includes/sidebarAdmin.html')
      .then(response => response.text())
      .then(data => document.getElementById('sidebar-container').innerHTML = data);

    // Fetch and include header content
    fetch('../includes/header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header-container').innerHTML = data;
          var menu = $('.js-item-menu');
          var sub_menu_is_showed = -1;

          for (var i = 0; i < menu.length; i++) {
            $(menu[i]).on('click', function (e) {
              e.preventDefault();
              $('.js-right-sidebar').removeClass("show-sidebar");
              if (jQuery.inArray(this, menu) == sub_menu_is_showed) {
                $(this).toggleClass('show-dropdown');
                sub_menu_is_showed = -1;
              }
              else {
                for (var i = 0; i < menu.length; i++) {
                  $(menu[i]).removeClass("show-dropdown");
                }
                $(this).toggleClass('show-dropdown');
                sub_menu_is_showed = jQuery.inArray(this, menu);
              }
            });
          }
          $(".js-item-menu, .js-dropdown").click(function (event) {
            event.stopPropagation();
          });

          var userDataString = sessionStorage.getItem('user');


          // Step 2: Parse the JSON string to get the user data as an object
          var userData = userDataString ? JSON.parse(userDataString) : null;

          // Step 3: Update the content of the header dynamically if userData is not null
          if (userData) {

            document.getElementById('adminNameLink').textContent = userData.username;
            document.getElementById('adminNameDropdown').textContent = userData.username;
          } else {
            console.error('User data is missing or invalid.');
          }
        });

    document.addEventListener('DOMContentLoaded', function () {
      // Assuming user ID is passed in the URL
      const userId = new URLSearchParams(window.location.search).get('id');

      if (userId) {
        // Make an AJAX request to fetch user details
        $.ajax({
          type: 'GET',
          url: `http://localhost:62416/api/Admin/User/${userId}`, // Replace with your actual API endpoint
          success: function (response) {
            // Handle the success response
            displayUserData(response);
          },
          error: function (error) {
            // Handle the error response (if needed)
            alert('Error fetching user details:', error);
          }
        });

        document.getElementById('updateBtn').addEventListener('click', function () {
          // Make an AJAX request to fetch the current user details
          $.ajax({
            type: 'GET',
            url: `http://localhost:62416/api/Admin/User/${userId}`, // Replace with your actual API endpoint
            success: function (response) {
              // Populate the modal with current user details
              document.getElementById('updateUsername').value = response.User_username;
              document.getElementById('updateUnitID').value = response.UnitID;
              document.getElementById('updateName').value = response.Name;
              document.getElementById('updateEmail').value = response.Email;
              document.getElementById('updateMobileNo').value = response.MobileNo;

              // Handle the update form submission
              document.getElementById('updateForm').addEventListener('submit', function (event) {
                event.preventDefault();
                // Get the updated user details from the form
                var updatedUserData = {
                  User_username: document.getElementById('updateUsername').value,
                  UnitID: document.getElementById('updateUnitID').value,
                  Name: document.getElementById('updateName').value,
                  Email: document.getElementById('updateEmail').value,
                  MobileNo: document.getElementById('updateMobileNo').value
                  // Add other fields as needed
                };

                // Make the AJAX request to update user details
                $.ajax({
                  type: 'PATCH',
                  url: `http://localhost:62416/api/Admin/User/${userId}`,
                  contentType: 'application/json',
                  data: JSON.stringify(updatedUserData),
                  success: function (response) {
                    // Handle success response
                    alert('User details updated successfully!');
                    // Redirect to users.html after a successful update
                    window.location.href = 'users.html';
                  },
                  error: function (error) {
                    // Handle error response
                    alert('Error updating user details:', error);
                  }
                });
              });
            },
            error: function (error) {
              // Handle the error response (if needed)
              alert('Error fetching user details:', error);
            }
          });
        });

        document.getElementById('deleteBtn').addEventListener('click', function () {
          $.ajax({
            type: 'DELETE',
            url: `http://localhost:62416/api/Admin/User/${userId}`,
            success: function (response) {
              alert(response); // Display success message
              window.location.href = 'users.html'; // Redirect to users.html after a successful delete
            },
            error: function (error) {
              alert('Error deleting user:', error);
            }
          });
        });

        function displayUserData(userData) {
          // Modify this function to display user details in your HTML
          // Example:
          document.getElementById('user-id').innerText = userData.UserID_id;
          document.getElementById('username').innerText = userData.User_username;
          document.getElementById('unit-id').innerText = userData.UnitID;
          document.getElementById('name').innerText = userData.Name;
          document.getElementById('email').innerText = userData.Email;
          document.getElementById('mobile-no').innerText = userData.MobileNo;
        }
      } else {
        alert('User ID not provided in the URL.');
      }
    });
  </script>
</head>

<body class="animsition">
  <div class="page-wrapper">
    <!-- HEADER MOBILE-->
    <div id="sidebar-container"></div>
    <!-- END HEADER MOBILE-->

    <!-- MENU SIDEBAR-->
    <!-- Include your menu sidebar content here -->
    <!-- END MENU SIDEBAR-->

    <!-- PAGE CONTAINER-->
    <div class="page-container">
      <!-- HEADER DESKTOP-->
      <div id="header-container"></div>
      <!-- END HEADER DESKTOP-->

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <div class="section__content section__content--p30">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-header">
                    <strong>User</strong> Details
                  </div>
                  <div class="card-body card-block">
                    <table border="1" class="table table-bordered mg-b-0">
                      <tr>
                        <th>User ID</th>
                        <td id="user-id"></td>
                      </tr>
                      <tr>
                        <th>Username</th>
                        <td id="username"></td>
                      </tr>
                      <tr>
                        <th>Unit ID</th>
                        <td id="unit-id"></td>
                      </tr>
                      <tr>
                        <th>Name</th>
                        <td id="name"></td>
                      </tr>
                      <tr>
                        <th>Email</th>
                        <td id="email"></td>
                      </tr>
                      <tr>
                        <th>Mobile No</th>
                        <td id="mobile-no"></td>
                      </tr>
                    </table>
                    <div class="text-center mt-4">
                      <button class="btn btn-primary mr-3" id="updateBtn" data-toggle="modal"
                        data-target="#updateModal">Update</button>
                      <button class="btn btn-danger" id="deleteBtn">Delete</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Update Modal -->
  <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Update User Details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Add your update form here -->
          <!-- Example: -->
          <form id="updateForm">
            <!-- Form fields for updating user details -->
            <!-- Example: -->
            <div class="form-group">
              <label for="updateUsername">Username</label>
              <input type="text" class="form-control" id="updateUsername" name="updateUsername"
                placeholder="Enter new username">
            </div>
            <div class="form-group">
              <label for="updateUnitID">Unit Identifier</label>
              <input type="text" class="form-control" id="updateUnitID" name="updateUnitID"
                placeholder="Enter new unit identifier">
            </div>
            <div class="form-group">
              <label for="updateName">Name</label>
              <input type="text" class="form-control" id="updateName" name="updateName" placeholder="Enter new name">
            </div>
            <div class="form-group">
              <label for="updateEmail">Email</label>
              <input type="email" class="form-control" id="updateEmail" name="updateEmail"
                placeholder="Enter new email address">
            </div>
            <div class="form-group">
              <label for="updateMobileNo">Mobile No</label>
              <input type="text" class="form-control" id="updateMobileNo" name="updateMobileNo"
                placeholder="Enter new mobile number">
            </div>
            <!-- Add other form fields as needed -->
            <button type="submit" class="btn btn-primary">Save changes</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Jquery JS-->
  <script src="../vendor/jquery-3.2.1.min.js"></script>
  <!-- Bootstrap JS-->
  <script src="../vendor/bootstrap-4.1/popper.min.js"></script>
  <script src="../vendor/bootstrap-4.1/bootstrap.min.js"></script>
  <!-- Vendor JS -->
  <script src="../vendor/slick/slick.min.js"></script>
  <script src="../vendor/wow/wow.min.js"></script>
  <script src="../vendor/animsition/animsition.min.js"></script>
  <script src="../vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
  <script src="../vendor/counter-up/jquery.waypoints.min.js"></script>
  <script src="../vendor/counter-up/jquery.counterup.min.js"></script>
  <script src="../vendor/circle-progress/circle-progress.min.js"></script>
  <script src="../vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="../vendor/chartjs/Chart.bundle.min.js"></script>
  <script src="../vendor/select2/select2.min.js"></script>

  <!-- Main JS-->
  <script src="../js/main.js"></script>

</body>

</html>